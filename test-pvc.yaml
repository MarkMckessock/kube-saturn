---
apiVersion: v1
kind: Pod
metadata:
  name: test-pvc
  namespace: media
spec:
  containers:
    - name: test-pod
      image: ubuntu
      command:
        [
          "/bin/bash",
          "-c",
          "apt update && apt install -y wget rsync tmux nano && rsync -rhavP /source/* /config",
        ]
      volumeMounts:
        - mountPath: /config
          name: plex
        - mountPath: /config/Library/Application Support/Plex Media Server/Cache
          name: plex-cache
        - mountPath: /source
          name: source
      resources:
        limits:
          memory: "128Mi"
          cpu: "500m"
  volumes:
    - name: plex
      persistentVolumeClaim:
        claimName: plex
    - name: plex-cache
      persistentVolumeClaim:
        claimName: plex-cache
    - name: source
      nfs:
        server: granite.markmckessock.com
        path: /volume1/Downloads/plex
  restartPolicy: Never
