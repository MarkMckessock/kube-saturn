machine:
  install:
    disk: /dev/disk/by-id/nvme-KINGSTON_OM8PGP41024N-A0_50026B7383A04617
    image: factory.talos.dev/installer/de3b865124c5616da8084826167f8c0b0fbc9b905b146290db797024e84097fc:{{ ENV.TALOS_VERSION }}
    extraKernelArgs:
      - i915.enable_guc=3                   # Meteor Lake CPU / iGPU
      - apparmor=0                          # Less security, faster puter
      - init_on_alloc=0                     # Less security, faster puter
      - init_on_free=0                      # Less security, faster puter
      - intel_iommu=on                      # PCI Passthrough
      - iommu=pt                            # PCI Passthrough
      - mitigations=off                     # Less security, faster puter
      - module_blacklist=igc                # Disable onboard NIC
      - security=none                       # Less security, faster puter
      - sysctl.kernel.kexec_load_disabled=1 # Meteor Lake CPU / iGPU
      - talos.auditd.disabled=1             # Less security, faster puter
  nodeLabels:
    intel.feature.node.kubernetes.io/gpu: "true"
  sysfs:
    devices.system.cpu.intel_pstate.hwp_dynamic_boost: 1
  udev:
    rules:
      - # Intel GPU
        SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
      - # Thunderbolt
        ACTION=="add", SUBSYSTEM=="thunderbolt", ATTR{authorized}=="0", ATTR{authorized}="1"
  kernel:
    modules:
      - name: nbd
      - name: thunderbolt
      - name: thunderbolt_net
  network:
    hostname: triton.neptune.kube.markmckessock.com
    interfaces:
      - interface: bond0
        addresses:
          - 10.0.70.61/24
        routes:
          - network: 0.0.0.0/0
            gateway: 10.0.70.1
        bond:
          mode: 802.3ad
          lacpRate: fast
          deviceSelectors:
            - hardwareAddr: '58:47:ca:7c:05:6e'
            - hardwareAddr: '58:47:ca:7c:05:6f'
        vip:
          ip: 10.0.70.60