---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: netbox-secret
  namespace: default
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: netbox-secret
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        db_password: '{{ .postgres_password }}'
        db_database: netbox
        db_username: netbox
        postgres_superuser_pass: '{{ .postgres_superuser_password }}'
        postgres_superuser_user: '{{ .postgres_superuser_user }}'
        email_password: '{{ .smtp_password }}'
        secret_key: '{{ .secret_key }}'
        redis_tasks_password: ""
        redis_cache_password: ""
        napalm_password: ""
        superuser_password: '{{ .superuser_password }}'
        superuser_api_token: '{{ .superuser_api_token}}'
        AWS_ACCESS_KEY_ID: '{{ .access_key_id }}'
        AWS_SECRET_ACCESS_KEY: '{{ .secret_access_key }}'
  dataFrom:
    - extract:
        key: netbox-secret
    - extract:
        key: cloudnative-pg-superuser
    - extract:
        key: netbox-minio-bucket
