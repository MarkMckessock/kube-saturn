---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: photoview
  namespace: photoview
spec:
  selector:
    matchLabels:
      app: photoview
  template:
    metadata:
      labels:
        app: photoview
    spec:
      containers:
        - name: photoview
          image: viktorstrate/photoview:2
          ports:
            - name: photoview
              containerPort: 80
          volumeMounts:
            - name: photos
              mountPath: /photos
            - name: photoview-cache
              mountPath: /app/cache
          env:
            - name: MAPBOX_TOKEN
              valueFrom:
                secretKeyRef:
                  name: photoview
                  key: MAPBOX_TOKEN
            - name: PHOTOVIEW_MYSQL_URL
              valueFrom:
                secretKeyRef:
                  name: photoview
                  key: PHOTOVIEW_MYSQL_URL
            - name: PHOTOVIEW_DATABASE_DRIVER
              value: mysql
            - name: PHOTOVIEW_LISTEN_PORT
              value: "80"
            - name: PHOTOVIEW_MEDIA_CACHE
              value: "/app/cache"
      volumes:
        - name: photos
          nfs:
            path: /volume1/Users/mmckessock/Pictures
            server: granite.${DOMAIN}
        - name: photoview-cache
          persistentVolumeClaim:
            claimName: cache
