apiVersion: apps/v1
kind: Deployment
metadata:
  name: paperless
  namespace: paperless
spec:
  selector:
    matchLabels:
      app: paperless
  template:
    metadata:
      labels:
        app: paperless
    spec:
      containers:
      - name: paperless
        image: jonaswinkler/paperless-ng:1.4.5
        ports:
        - name: paperless
          containerPort: 8000
        volumeMounts:
          - mountPath: /usr/src/paperless/data
            name: data
          - mountPath: /usr/src/paperless/media
            name: media
          - mountPath: /usr/src/paperless/consume
            name: consume
        env:
          - name: PAPERLESS_SECRET_KEY
            valueFrom:
              secretKeyRef:
                name: paperless
                key: PAPERLESS_SECRET_KEY
          - name: USERMAP_UID
            value: "1000"
          - name: USERMAP_GID
            value: "1000"
          - name: PAPERLESS_TIME_ZONE
            value: America/Toronto
          - name: PAPERLESS_REDIS
            value: redis://localhost:6379
          - name: PAPERLESS_OCR_LANGUAGE
            value: eng
      - name: redis
        image: redis:6.0
      nodeSelector:
        node-role.kubernetes.io/worker: worker
      volumes:
        - name: consume
          persistentVolumeClaim:
            claimName: paperless-consume
        - name: data
          persistentVolumeClaim:
            claimName: paperless-data
        - name: media
          persistentVolumeClaim:
            claimName: paperless-media
