apiVersion: batch/v1
kind: CronJob
metadata:
  name: f1-plex-meta-manager
  namespace: media
spec:
  schedule: "0 */6 * * *"
  successfulJobsHistoryLimit: 1
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: f1-plex-meta-manager
              image: markmckessock/f1-plex-meta-manager:v1.16.1
              env:
                - name: PMM_READ_ONLY_CONFIG
                  value: "true"
                - name: PMM_RUN
                  value: "true"
              volumeMounts:
                - name: collections
                  mountPath: /collections
                - name: plex-meta-config
                  mountPath: /config/config.yml
                  subPath: config.yml
                - name: plex-meta-data
                  mountPath: /config
                - name: formula-1-collections
                  subPath: Formula1.yml
                  mountPath: /collections/Formula1.yml
          volumes:
            - name: collections
              emptyDir: {}
            - name: plex-meta-config
              secret:
                secretName: f1-plex-meta-config
            - name: formula-1-collections
              configMap:
                name: formula-1-collections
            - name: plex-meta-data
              persistentVolumeClaim:
                claimName: f1-plex-meta-manager
          restartPolicy: Never
          nodeSelector:
            kubernetes.io/arch: amd64
