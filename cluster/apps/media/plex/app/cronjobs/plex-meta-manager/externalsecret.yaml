---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: plex-meta-manager-config
  namespace: media
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: doppler-plex
  target:
    name: plex-meta-manager-config
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        config.yaml: |-
          libraries:
            Movies:
              metadata_path:
                - file: /collections/movies-movies.yaml
                - file: /collections/movies-charts.yaml
                - file: /collections/movies-holidays.yaml
                - file: /collections/movies-studios.yaml
            TV Shows:
              metadata_path:
                - file: /collections/tv-charts.yaml

          settings:
            cache: true
            cache_expiration: 60
            asset_directory: config/assets
            asset_folders: true
            create_asset_folders: false
            sync_mode: append
            show_unmanaged: true
            show_filtered: false
            show_missing: true
            show_missing_assets: true
            save_missing: true
            run_again_delay: 2
            missing_only_released: false
            only_filter_missing: false
            collection_minimum: 1
            delete_below_minimum: true
            delete_not_scheduled: false
            tvdb_language: eng

          plex:
            url: http://plex.media.svc:32400
            token: {{ .PLEX_TOKEN }}
            timeout: 60
            clean_bundles: false
            empty_trash: false
            optimize: false
          tmdb:
            apikey: {{ .TMDB_API_KEY }}
            language: en
          omdb:
            apikey: {{ .OMDB_API_KEY }}
          radarr:                                         # Can be individually specified per library as well
            url: http://radarr:7878
            token: {{ .RADARR_API_KEY }}
            add: false
            root_folder_path: "/media/movies/main/<4K"
            monitor: true
            availability: announced
            quality_profile: HD-1080p
            tag:
            search: false
          sonarr:                                         # Can be individually specified per library as well
            url: http://sonarr:8989
            token: {{ .SONARR_API_KEY }}
            add: false
            root_folder_path: "/media/tv shows"
            monitor: all
            quality_profile: HD-1080p
            language_profile: English
            series_type: standard
            season_folder: true
            tag:
            search: false
            cutoff_search: false
          # trakt:
          #   client_id: ################################################################
          #   client_secret: ################################################################
          #   authorization:
          #     # everything below is autofilled by the script
          #     access_token:
          #     token_type:
          #     expires_in:
          #     refresh_token:
          #     scope: public
          #     created_at:
  dataFrom:
    - find:
        name:
          regexp: .*
