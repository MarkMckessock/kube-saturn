apiVersion: batch/v1
kind: CronJob
metadata:
  name: plex-meta-manager
  namespace: media
spec:
  schedule: "0 */6 * * *"
  successfulJobsHistoryLimit: 0
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: plex-meta-manager
              image: meisnate12/plex-meta-manager:v1.16.2
              env:
                - name: PMM_READ_ONLY_CONFIG
                  value: "true"
                - name: PMM_RUN
                  value: "true"
              volumeMounts:
                - name: collections
                  mountPath: /collections
                - name: plex-meta-config
                  mountPath: /config/config.yml
                  subPath: config.yml
                - name: plex-meta-data
                  mountPath: /config
                - name: collections-movies
                  subPath: movies.yaml
                  mountPath: /collections/movies-movies.yaml
                - name: collections-movies-charts
                  subPath: charts.yaml
                  mountPath: /collections/movies-charts.yaml
                - name: collections-movies-holidays
                  subPath: holidays.yaml
                  mountPath: /collections/movies-holidays.yaml
                - name: collections-shows-charts
                  subPath: charts.yaml
                  mountPath: /collections/shows-carts.yaml
          volumes:
            - name: collections
              emptyDir: {}
            - name: plex-meta-config
              secret:
                secretName: plex-meta-config
            - name: collections-movies
              configMap:
                name: collections-movies
            - name: collections-movies-charts
              configMap:
                name: collections-movies-charts
            - name: collections-movies-holidays
              configMap:
                name: collections-movies-holidays
            - name: collections-shows-charts
              configMap:
                name: collections-shows-charts
            - name: plex-meta-data
              persistentVolumeClaim:
                claimName: plex-meta-manager
          restartPolicy: Never
          nodeSelector:
            kubernetes.io/arch: amd64
