---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: supabase-db
  namespace: horse-show-app
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: supabase-db
    template:
      engineVersion: v2
      data:
        username: '{{ .PG_USERNAME }}'
        password: '{{ .PG_PASSWORD }}'
        DATABASE_URL: postgres://{{ .PG_USERNAME }}:{{ .PG_PASSWORD }}@supabase-db.horse-show-app.svc.cluster.local:5432/supabase
  dataFrom:
    - extract:
        key: supabase-db
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: supabase-smtp
  namespace: horse-show-app
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: supabase-smtp
  data:
    - secretKey: username
      remoteRef:
        key: supabase-smtp
        property: SMTP_USERNAME
    - secretKey: password
      remoteRef:
        key: supabase-smtp
        property: SMTP_PASSWORD
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: supabase-jwt
  namespace: horse-show-app
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: supabase-jwt
  data:
    - secretKey: anonKey
      remoteRef:
        key: supabase-jwt
        property: ANON_KEY
    - secretKey: serviceKey
      remoteRef:
        key: supabase-jwt
        property: SERVICE_KEY
    - secretKey: secret
      remoteRef:
        key: supabase-jwt
        property: SECRET
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: supabase-realtime
  namespace: horse-show-app
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: supabase-realtime
    template:
      engineVersion: v2
      data:
        SECRET_KEY_BASE: '{{ .SECRET_KEY_BASE }}'
        DB_ENC_KEY: '{{ .DB_ENC_KEY }}'
  dataFrom:
    - extract:
        key: supabase-realtime
