apiVersion: batch/v1
kind: Job
metadata:
  name: init-db-${dbName}
  namespace: database
spec:
  ttlSecondsAfterFinished: 100
  template:
    spec:
      containers:
      - name: init-db
        image: ghcr.io/onedr0p/postgres-initdb:14.6
        env:
          - name: POSTGRES_DB
            value: ${dbName}
          - name: POSTGRES_USER
            value: ${dbUser}
          - name: POSTGRES_PASS
            value: ${dbPassword}
          - name: POSTGRES_SUPER_USER
            valueFrom:
              secretKeyRef:
                name: cloudnative-pg-postgres-superuser
                key: username
          - name: POSTGRES_SUPER_PASS
            valueFrom:
              secretKeyRef:
                name: cloudnative-pg-postgres-superuser
                key: password
          - name: POSTGRES_HOST
            value: postgres-rw
      restartPolicy: Never


