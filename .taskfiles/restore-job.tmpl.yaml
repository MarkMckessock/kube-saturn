---
apiVersion: batch/v1
kind: Job
metadata:
  name: restore-${src}
  namespace: ${namespace}
spec:
  template:
    spec:
      containers:
        - name: backup
          image: ubuntu
          command:
            - /bin/bash
            - -c
          args:
            [
              "rm -rf /dst/* && tar -xzvf /backups/${date}-pvc-backup/${namespace}_${src}.tar.gz --strip-components 1 -C /dst",
            ]
          volumeMounts:
            - mountPath: /dst
              name: pvc
            - mountPath: /backups
              name: backups
      restartPolicy: Never
      volumes:
        - name: pvc
          persistentVolumeClaim:
            claimName: ${src}
        - name: backups
          nfs:
            path: /volume1/Backups/Homelab Backups
            server: granite.markmckessock.com
