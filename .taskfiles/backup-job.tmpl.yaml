---
apiVersion: batch/v1
kind: Job
metadata:
  name: backup-${src}
  namespace: ${namespace}
spec:
  template:
    spec:
      containers:
        - name: backup
          image: ubuntu
          command:
            - /bin/bash
            - -c
          args: ["mkdir -p /dst/${date}-pvc-backup && tar -czvf /dst/${date}-pvc-backup/${namespace}_${src}.tar.gz /src"]
          volumeMounts:
            - mountPath: /src
              name: pvc
            - mountPath: /dst
              name: backups
      restartPolicy: Never
      volumes:
        - name: pvc
          persistentVolumeClaim:
            claimName: ${src}
        - name: backups
          nfs:
            path: /volume1/Backups/Homelab Backups
            server: granite.markmckessock.com
